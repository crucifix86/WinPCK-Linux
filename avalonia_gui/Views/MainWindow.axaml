<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:WinPCK.Avalonia.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
        x:Class="WinPCK.Avalonia.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="{Binding Title}"
        Width="1000" Height="700"
        MinWidth="800" MinHeight="600">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <DockPanel>
        <!-- Top Toolbar -->
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Spacing="5" Margin="5">
            <Button Command="{Binding OpenFileCommand}" IsEnabled="{Binding !IsOperationInProgress}">
                <StackPanel Orientation="Horizontal" Spacing="5">
                    <TextBlock Text="ðŸ“"/>
                    <TextBlock Text="Open"/>
                </StackPanel>
            </Button>
            <Button Command="{Binding CreateNewPckCommand}" IsEnabled="{Binding !IsOperationInProgress}">
                <StackPanel Orientation="Horizontal" Spacing="5">
                    <TextBlock Text="âœ¨"/>
                    <TextBlock Text="New PCK"/>
                </StackPanel>
            </Button>
            <Button Command="{Binding BatchExtractCommand}" IsEnabled="{Binding !IsOperationInProgress}">
                <StackPanel Orientation="Horizontal" Spacing="5">
                    <TextBlock Text="âš¡"/>
                    <TextBlock Text="Batch Extract"/>
                </StackPanel>
            </Button>
            <Button Command="{Binding CloseFileCommand}" IsEnabled="{Binding IsFileOpen}">
                <StackPanel Orientation="Horizontal" Spacing="5">
                    <TextBlock Text="âŒ"/>
                    <TextBlock Text="Close"/>
                </StackPanel>
            </Button>
            <Separator Width="1" Background="Gray"/>
            <Button Command="{Binding AddFilesCommand}" IsEnabled="{Binding IsFileOpen}">
                <StackPanel Orientation="Horizontal" Spacing="5">
                    <TextBlock Text="âž•"/>
                    <TextBlock Text="Add Files"/>
                </StackPanel>
            </Button>
            <Button Command="{Binding RebuildPckCommand}" IsEnabled="{Binding IsFileOpen}">
                <StackPanel Orientation="Horizontal" Spacing="5">
                    <TextBlock Text="ðŸ”§"/>
                    <TextBlock Text="Rebuild"/>
                </StackPanel>
            </Button>
            <Separator Width="1" Background="Gray"/>
            <Button Command="{Binding ShowInfoCommand}" IsEnabled="{Binding IsFileOpen}">
                <StackPanel Orientation="Horizontal" Spacing="5">
                    <TextBlock Text="â„¹ï¸"/>
                    <TextBlock Text="Info"/>
                </StackPanel>
            </Button>
            <Separator Width="1" Background="Gray"/>
            <Button Command="{Binding ExtractAllCommand}" IsEnabled="{Binding IsFileOpen}">
                <StackPanel Orientation="Horizontal" Spacing="5">
                    <TextBlock Text="ðŸ“¦"/>
                    <TextBlock Text="Extract All"/>
                </StackPanel>
            </Button>
            <Button Command="{Binding ExtractSelectedCommand}" IsEnabled="{Binding IsFileOpen}">
                <StackPanel Orientation="Horizontal" Spacing="5">
                    <TextBlock Text="ðŸ“¤"/>
                    <TextBlock Text="Extract Selected"/>
                </StackPanel>
            </Button>
            <Separator Width="1" Background="Gray"/>
            <Button Command="{Binding SearchCommand}" IsEnabled="{Binding IsFileOpen}">
                <StackPanel Orientation="Horizontal" Spacing="5">
                    <TextBlock Text="ðŸ”"/>
                    <TextBlock Text="Search"/>
                </StackPanel>
            </Button>
            <Separator Width="1" Background="Gray"/>
            <Button Command="{Binding ClearLogCommand}">
                <StackPanel Orientation="Horizontal" Spacing="5">
                    <TextBlock Text="ðŸ—‘ï¸"/>
                    <TextBlock Text="Clear Log"/>
                </StackPanel>
            </Button>
        </StackPanel>

        <!-- Bottom Status Bar -->
        <Grid DockPanel.Dock="Bottom" Background="#E0E0E0" Height="25">
            <TextBlock Text="{Binding StatusText}" VerticalAlignment="Center" Margin="10,0"/>
        </Grid>

        <!-- Progress Bar -->
        <ProgressBar DockPanel.Dock="Bottom"
                     Height="8"
                     Value="{Binding ProgressValue}"
                     Maximum="100"
                     IsIndeterminate="{Binding IsOperationInProgress}"
                     IsVisible="{Binding IsOperationInProgress}"/>

        <!-- Main Content -->
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="2*"/>
                <RowDefinition Height="4"/>
                <RowDefinition Height="1*"/>
            </Grid.RowDefinitions>

            <!-- File Browser with TreeView and Details -->
            <Border Grid.Row="0" BorderBrush="Gray" BorderThickness="1" Margin="5">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="250" MinWidth="150"/>
                        <ColumnDefinition Width="4"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- TreeView for folder navigation -->
                    <Border Grid.Column="0" BorderBrush="Gray" BorderThickness="0,0,1,0">
                        <TreeView ItemsSource="{Binding TreeRootNodes}"
                                  SelectedItem="{Binding SelectedTreeNode}">
                            <TreeView.ItemTemplate>
                                <TreeDataTemplate ItemsSource="{Binding Children}">
                                    <StackPanel Orientation="Horizontal" Spacing="5">
                                        <TextBlock Text="{Binding Icon}"/>
                                        <TextBlock Text="{Binding DisplayName}"/>
                                    </StackPanel>
                                </TreeDataTemplate>
                            </TreeView.ItemTemplate>
                        </TreeView>
                    </Border>

                    <GridSplitter Grid.Column="1" ResizeDirection="Columns" Background="Gray"/>

                    <!-- File List -->
                    <Border Grid.Column="2" BorderBrush="Gray" BorderThickness="1" Background="White">
                        <DockPanel>
                            <TextBlock DockPanel.Dock="Top" Margin="5" FontWeight="Bold" Background="#E0E0E0" Padding="5"
                                       Text="{Binding CurrentFolderEntries.Count, StringFormat='Items: {0}'}"/>

                            <ListBox ItemsSource="{Binding CurrentFolderEntries}"
                                     SelectedItem="{Binding SelectedEntry}"
                                     SelectedItems="{Binding SelectedEntries, Mode=TwoWay}"
                                     SelectionMode="Multiple"
                                     Background="White"
                                     BorderThickness="0"
                                     x:Name="FileListBox">
                                <ListBox.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="Extract Selected" Command="{Binding ExtractSelectedCommand}">
                                            <MenuItem.Icon>
                                                <TextBlock Text="ðŸ“¤"/>
                                            </MenuItem.Icon>
                                        </MenuItem>
                                        <Separator/>
                                        <MenuItem Header="Rename" Command="{Binding RenameFileCommand}">
                                            <MenuItem.Icon>
                                                <TextBlock Text="âœï¸"/>
                                            </MenuItem.Icon>
                                        </MenuItem>
                                        <MenuItem Header="Delete" Command="{Binding DeleteFileCommand}">
                                            <MenuItem.Icon>
                                                <TextBlock Text="ðŸ—‘ï¸"/>
                                            </MenuItem.Icon>
                                        </MenuItem>
                                    </ContextMenu>
                                </ListBox.ContextMenu>
                                <ListBox.Styles>
                                    <Style Selector="ListBoxItem">
                                        <Setter Property="Padding" Value="2"/>
                                        <Setter Property="Margin" Value="0"/>
                                    </Style>
                                </ListBox.Styles>
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Grid MinHeight="24">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="40"/>
                                                <ColumnDefinition Width="2*"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="70"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="{Binding TypeIcon}" Margin="5,0" FontSize="16" Foreground="Black"/>
                                            <TextBlock Grid.Column="1" Text="{Binding Name}" Margin="5,0" VerticalAlignment="Center" Foreground="Black" FontSize="13"/>
                                            <TextBlock Grid.Column="2" Text="{Binding SizeFormatted}" Margin="5,0" HorizontalAlignment="Right" VerticalAlignment="Center" Foreground="#333333" FontSize="12"/>
                                            <TextBlock Grid.Column="3" Text="{Binding CompressedSizeFormatted}" Margin="5,0" HorizontalAlignment="Right" VerticalAlignment="Center" Foreground="#333333" FontSize="12"/>
                                            <TextBlock Grid.Column="4" Text="{Binding CompressionRatio}" Margin="5,0" HorizontalAlignment="Right" VerticalAlignment="Center" Foreground="#555555" FontSize="12"/>
                                        </Grid>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </DockPanel>
                    </Border>
                </Grid>
            </Border>

            <GridSplitter Grid.Row="1" ResizeDirection="Rows" Background="Gray"/>

            <!-- Log Panel -->
            <Border Grid.Row="2" BorderBrush="Gray" BorderThickness="1" Margin="5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="Log Messages" FontWeight="Bold" Margin="5"/>

                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding LogMessages}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}"
                                               FontFamily="Consolas,Monospace"
                                               FontSize="11"
                                               Margin="2,0"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>
    </DockPanel>
</Window>
